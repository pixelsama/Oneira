# èµ„æºåº“å¢å¼ºåŠŸèƒ½è®¡åˆ’

**åˆ›å»ºæ—¥æœŸ**: 2026-01-19  
**çŠ¶æ€**: å¾…å®æ–½  
**ä¼˜å…ˆçº§**: é«˜

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

é‡æ–°å®šä¹‰"èµ„æºåº“"æ¦‚å¿µï¼Œå°†å…¶å‡çº§ä¸ºä¸€ä¸ªå®Œæ•´çš„**èµ„æºç®¡ç†ä¸å¼•ç”¨ç³»ç»Ÿ**ã€‚èµ„æºï¼ˆResourceï¼‰æ˜¯ç”±**å›¾ç‰‡ç»„ + æç¤ºè¯**ç»„åˆæ„æˆçš„å¤åˆå®ä½“ï¼Œç”¨æˆ·å¯ä»¥åœ¨ç”Ÿå›¾ç•Œé¢é€šè¿‡ `@` ç¬¦å·ç›´æ¥å¼•ç”¨æ•´ä¸ªèµ„æºï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†èµ„æºä¸­çš„å›¾ç‰‡å’Œæç¤ºè¯ä¸€å¹¶æ³¨å…¥åˆ°ç”Ÿæˆæµç¨‹ä¸­ã€‚

### ä¸ç°æœ‰ç³»ç»Ÿçš„å·®å¼‚

| ç»´åº¦       | å½“å‰å®ç°                                 | ç›®æ ‡çŠ¶æ€                              |
| ---------- | ---------------------------------------- | ------------------------------------- |
| @ å¼•ç”¨èŒƒå›´ | ä»…æ”¯æŒå¼•ç”¨å•å¼ å‚è€ƒå›¾ç‰‡                   | æ”¯æŒå¼•ç”¨**èµ„æº**ï¼ˆå›¾ç‰‡ç»„ + æç¤ºè¯ï¼‰   |
| å¼•ç”¨æ•ˆæœ   | ä»…æ³¨å…¥å›¾ç‰‡                               | è‡ªåŠ¨æ³¨å…¥èµ„æºä¸­çš„**æ‰€æœ‰å›¾ç‰‡ + æç¤ºè¯** |
| èµ„æºåº“å®šä½ | ç‹¬ç«‹çš„èµ„æºç®¡ç†é¡µé¢ï¼Œéœ€æ‰‹åŠ¨"åŠ è½½"åˆ°å·¥ä½œå° | å¯åœ¨è¾“å…¥æ¡†ä¸­**ç›´æ¥ @ å¼•ç”¨**ï¼Œæ— ç¼é›†æˆ |
| ç”¨æˆ·ä½“éªŒ   | ä¸¤æ­¥æ“ä½œï¼šå…ˆåŠ è½½èµ„æºï¼Œå†ç”Ÿæˆ             | ä¸€æ­¥æ“ä½œï¼š@ å¼•ç”¨åç›´æ¥ç”Ÿæˆ            |

---

## ğŸ¯ ç›®æ ‡ç”¨æˆ·ä½“éªŒ

### 1. @ å¼•ç”¨èµ„æº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Prompt è¾“å…¥æ¡†                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ä½¿ç”¨ [ğŸ“¦ åŠ¨æ¼«è§’è‰²é£æ ¼] ç»˜åˆ¶ä¸€åªåœ¨é›ªåœ°å¥”è·‘çš„çŒ«@               â”‚â”‚
â”‚  â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚                                              â”‚ ğŸ“· å‚è€ƒå›¾A  â”‚ â”‚â”‚ â† å•å¼ å›¾ç‰‡
â”‚  â”‚                                              â”‚ ğŸ“¦ åŠ¨æ¼«è§’è‰²é£æ ¼â”‚ â”‚â”‚ â† èµ„æº
â”‚  â”‚                                              â”‚ ğŸ“¦ èƒŒæ™¯ç´ æåŒ…  â”‚ â”‚â”‚ â† èµ„æº
â”‚  â”‚                                              â”‚ ğŸ“· å‚è€ƒå›¾B  â”‚ â”‚â”‚ â† å•å¼ å›¾ç‰‡
â”‚  â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®äº¤äº’**:

- èœå•åŒæ—¶å±•ç¤º**å‚è€ƒå›¾ç‰‡**ï¼ˆğŸ“·ï¼‰å’Œ**èµ„æº**ï¼ˆğŸ“¦ï¼‰
- ç”¨æˆ·é€‰æ‹©èµ„æºåï¼Œæ˜¾ç¤ºèµ„æºæ ‡ç­¾ `[ğŸ“¦ èµ„æºåç§°]`
- **åå°è¡Œä¸º**ï¼šè‡ªåŠ¨å°†èµ„æºçš„æç¤ºè¯è¿½åŠ åˆ° promptï¼Œå¹¶å°†èµ„æºæ‰€å«å›¾ç‰‡åŠ å…¥ `reference_images`

### 2. èµ„æºåº“ç®¡ç†ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Resource Library                                    [+ New Resource]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“¦ åŠ¨æ¼«è§’è‰²é£æ ¼                                  âœï¸  ğŸ—‘ï¸  â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚ â”‚ Prompt: anime style, vibrant colors, detailed...           â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚ â”‚ [ğŸ–¼ï¸ img1] [ğŸ–¼ï¸ img2] [ğŸ–¼ï¸ img3]                             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“¦ å†™å®äººåƒ                                      âœï¸  ğŸ—‘ï¸  â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚ â”‚ Prompt: photorealistic, 8k, detailed skin texture...       â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚ â”‚ [ğŸ–¼ï¸ img4]                                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. èµ„æºåˆ›å»º/ç¼–è¾‘ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Create New Resource                                     [Ã—]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Name                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åŠ¨æ¼«è§’è‰²é£æ ¼                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Description (Optional)                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç”¨äºç”Ÿæˆæ—¥ç³»åŠ¨æ¼«é£æ ¼è§’è‰²çš„èµ„æºåŒ…                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Prompt                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ anime style, vibrant colors, detailed linework,          â”‚   â”‚
â”‚  â”‚ character illustration, --ar 1:1                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Reference Images                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  ğŸ–¼ï¸      â”‚ â”‚  ğŸ–¼ï¸      â”‚ â”‚  ğŸ–¼ï¸      â”‚ â”‚    +     â”‚           â”‚
â”‚  â”‚ style1   â”‚ â”‚ style2   â”‚ â”‚ style3   â”‚ â”‚  Upload  â”‚           â”‚
â”‚  â”‚    âŒ    â”‚ â”‚    âŒ    â”‚ â”‚    âŒ    â”‚ â”‚          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚                                        [Cancel]  [Save Resource]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•°æ®æ¨¡å‹å˜æ›´

#### ç°æœ‰ `Resource` æ¥å£ï¼ˆå‰ç«¯ï¼‰

```typescript
// src/stores/resourceStore.ts
export interface Resource {
  id: string;
  name: string;
  description?: string;
  promptTemplate: string;
  images: string[]; // å›¾ç‰‡è·¯å¾„åˆ—è¡¨
  createdAt: number;
  updatedAt: number;
}
```

**æ— éœ€ä¿®æ”¹**ï¼šç°æœ‰æ•°æ®æ¨¡å‹å·²æ»¡è¶³éœ€æ±‚ã€‚

#### æ–°å¢ç±»å‹ï¼šåŒºåˆ†å¼•ç”¨ç±»å‹

```typescript
// src/types/prompt.ts (æ‰©å±•)
export interface PromptContent {
  type: 'text' | 'image-reference' | 'resource-reference'; // æ–°å¢ resource-reference
  value: string; // å›¾ç‰‡ ID æˆ–èµ„æº ID
}
```

### @ æåŠç³»ç»Ÿæ‰©å±•

#### MentionMenu éœ€å±•ç¤ºä¸¤ç±»æ•°æ®

```typescript
// MentionMenu.tsx

interface MentionItem {
  id: string;
  type: 'image' | 'resource';
  displayName: string;
  thumbnail?: string; // å•å¼ å›¾ç‰‡ç¼©ç•¥å›¾ æˆ– èµ„æºçš„é¦–å¼ å›¾ç‰‡ç¼©ç•¥å›¾
  imageCount?: number; // èµ„æºåŒ…å«çš„å›¾ç‰‡æ•°é‡
  promptPreview?: string; // èµ„æºçš„æç¤ºè¯é¢„è§ˆ
}
```

#### å¼•ç”¨æ ‡ç­¾æ ·å¼åŒºåˆ†

| ç±»å‹     | å›¾æ ‡ | èƒŒæ™¯è‰²          | ç¤ºä¾‹              |
| -------- | ---- | --------------- | ----------------- |
| å•å¼ å›¾ç‰‡ | ğŸ“·   | `purple-900/50` | `[ğŸ“· è§’è‰²è®¾è®¡å›¾]` |
| èµ„æº     | ğŸ“¦   | `blue-900/50`   | `[ğŸ“¦ åŠ¨æ¼«é£æ ¼åŒ…]` |

---

## ğŸ“¦ å®æ–½é˜¶æ®µ

### Phase 1: ç±»å‹ç³»ç»Ÿä¸æ•°æ®å±‚ (é¢„è®¡ 30 åˆ†é’Ÿ)

#### 1.1 æ‰©å±• PromptContent ç±»å‹

**æ–‡ä»¶**: `src/types/prompt.ts`

```typescript
export interface PromptContent {
  type: 'text' | 'image-reference' | 'resource-reference';
  value: string;
}
```

#### 1.2 ä¸º ResourceStore æ·»åŠ è¾…åŠ©æ–¹æ³•

**æ–‡ä»¶**: `src/stores/resourceStore.ts`

```typescript
interface ResourceState {
  // ... existing
  getResourceById: (id: string) => Resource | undefined;
  getResourceByName: (name: string) => Resource | undefined;
}
```

---

### Phase 2: MentionMenu æ‰©å±• (é¢„è®¡ 1 å°æ—¶)

#### 2.1 ç»Ÿä¸€æ•°æ®æº

MentionMenu éœ€åŒæ—¶æ¶ˆè´¹ `referenceImageStore` å’Œ `resourceStore`ï¼š

```typescript
// MentionMenu.tsx
import { useReferenceImageStore } from '../../../stores/referenceImageStore';
import { useResourceStore } from '../../../stores/resourceStore';

const { images } = useReferenceImageStore();
const { resources } = useResourceStore();

// åˆå¹¶ä¸ºç»Ÿä¸€æ ¼å¼
const mentionItems: MentionItem[] = [
  ...images.map((img) => ({
    id: img.id,
    type: 'image' as const,
    displayName: img.displayName,
    thumbnail: img.thumbnailDataUrl,
  })),
  ...resources.map((res) => ({
    id: res.id,
    type: 'resource' as const,
    displayName: res.name,
    thumbnail: res.images[0] || undefined, // é¦–å¼ å›¾ç‰‡ä½œä¸ºç¼©ç•¥å›¾
    imageCount: res.images.length,
    promptPreview: res.promptTemplate.substring(0, 50) + '...',
  })),
];
```

#### 2.2 UI åŒºåˆ†

```tsx
// èµ„æºæ¡ç›®æ¸²æŸ“
<li className={`flex items-center gap-2 p-2 ...`}>
  {item.type === 'resource' ? (
    <Package size={14} className="text-blue-400" />
  ) : (
    <ImageIcon size={14} className="text-purple-400" />
  )}
  <div className="flex flex-col">
    <span className="truncate">{item.displayName}</span>
    {item.type === 'resource' && (
      <span className="text-xs text-[var(--text-secondary)]">
        {item.imageCount} images â€¢ {item.promptPreview}
      </span>
    )}
  </div>
</li>
```

---

### Phase 3: PromptInput æ‰©å±• (é¢„è®¡ 1 å°æ—¶)

#### 3.1 èµ„æºæ ‡ç­¾æ¸²æŸ“

åœ¨ `insertImageTag` å‡½æ•°æ—æ–°å¢ `insertResourceTag`ï¼š

```typescript
const insertResourceTag = (resource: Resource) => {
  // ...ç±»ä¼¼ insertImageTag é€»è¾‘

  const tag = document.createElement('span');
  tag.contentEditable = 'false';
  tag.className =
    'inline-flex items-center gap-1 bg-blue-900/50 text-blue-200 px-1.5 py-0.5 rounded text-xs mx-1 align-middle border border-blue-700 select-none';
  tag.dataset.resourceId = resource.id;
  tag.innerHTML = `<svg ...Package icon.../><span>${resource.name}</span>`;

  // ...æ’å…¥é€»è¾‘
};
```

#### 3.2 parseContent æ‰©å±•

```typescript
const walk = (node: Node) => {
  // ...existing
  else if (el.dataset.resourceId) {
    content.push({ type: 'resource-reference', value: el.dataset.resourceId });
  }
  // ...
};
```

---

### Phase 4: GenerationStore é€»è¾‘æ‰©å±• (é¢„è®¡ 1 å°æ—¶)

**æ ¸å¿ƒå˜æ›´**ï¼šåœ¨ç”Ÿæˆæ—¶ï¼Œéœ€è¦ï¼š

1. **å±•å¼€èµ„æºæç¤ºè¯**ï¼šå°†èµ„æºçš„ `promptTemplate` è¿½åŠ åˆ°æœ€ç»ˆ prompt
2. **å±•å¼€èµ„æºå›¾ç‰‡**ï¼šå°†èµ„æºçš„ `images` åŠ å…¥ `reference_images`

#### 4.1 getSerializedPrompt æ‰©å±•

```typescript
getSerializedPrompt: () => {
  const { promptContent } = get();

  return promptContent
    .map((item) => {
      if (item.type === 'text') return item.value;
      if (item.type === 'image-reference') {
        const img = useReferenceImageStore.getState().getImageById(item.value);
        return img ? `[å‚è€ƒå›¾:${img.displayName}]` : '';
      }
      if (item.type === 'resource-reference') {
        const res = useResourceStore.getState().getResourceById(item.value);
        if (!res) return '';
        // å°†èµ„æºçš„æç¤ºè¯ç›´æ¥åµŒå…¥
        return res.promptTemplate;
      }
      return '';
    })
    .join('');
};
```

#### 4.2 getReferencedImagePaths æ‰©å±•

```typescript
getReferencedImagePaths: () => {
  const { promptContent } = get();
  const paths: string[] = [];

  promptContent.forEach((item) => {
    if (item.type === 'image-reference') {
      const img = useReferenceImageStore.getState().getImageById(item.value);
      if (img) paths.push(img.originalPath);
    }
    if (item.type === 'resource-reference') {
      const res = useResourceStore.getState().getResourceById(item.value);
      if (res) {
        paths.push(...res.images); // èµ„æºçš„æ‰€æœ‰å›¾ç‰‡éƒ½åŠ å…¥
      }
    }
  });

  return paths;
};
```

---

### Phase 5: UI/UX ä¼˜åŒ– (é¢„è®¡ 30 åˆ†é’Ÿ)

#### 5.1 èµ„æºåº“é¡µé¢ä¼˜åŒ–

- èµ„æºå¡ç‰‡å±•ç¤ºï¼šåç§°ã€æç¤ºè¯é¢„è§ˆã€å›¾ç‰‡ç¼©ç•¥å›¾ç½‘æ ¼
- æ‚¬åœæ˜¾ç¤ºå®Œæ•´æç¤ºè¯
- å¿«æ·æ“ä½œï¼šç¼–è¾‘ã€åˆ é™¤ã€å¤åˆ¶åˆ°å‰ªè´´æ¿

#### 5.2 èµ„æºåˆ›å»ºç•Œé¢å¢å¼º

- å®æ—¶é¢„è§ˆï¼šæ˜¾ç¤ºä¿å­˜åçš„èµ„æºå¡ç‰‡å¤–è§‚
- å›¾ç‰‡æ‹–æ‹½æ’åº
- æç¤ºè¯æ¨¡æ¿å˜é‡æç¤ºï¼ˆå¯é€‰åŠŸèƒ½ï¼‰

---

## âœ… å®æ–½æ£€æŸ¥æ¸…å•

### Phase 1: ç±»å‹ä¸æ•°æ®å±‚

- [ ] æ‰©å±• `PromptContent` ç±»å‹ï¼Œæ–°å¢ `resource-reference`
- [ ] ä¸º `ResourceStore` æ·»åŠ  `getResourceById` æ–¹æ³•
- [ ] ä¸º `ResourceStore` æ·»åŠ  `getResourceByName` æ–¹æ³•
- [ ] ç¡®ä¿é¡µé¢åŠ è½½æ—¶ `loadResources` è¢«è°ƒç”¨

### Phase 2: MentionMenu

- [ ] å¼•å…¥ `useResourceStore`
- [ ] åˆå¹¶ images å’Œ resources ä¸ºç»Ÿä¸€ `mentionItems`
- [ ] å®ç°è¿‡æ»¤é€»è¾‘ï¼ˆåŒæ—¶æœç´¢å›¾ç‰‡åå’Œèµ„æºåï¼‰
- [ ] åŒºåˆ†æ¸²æŸ“ï¼šå›¾ç‰‡ç”¨ ğŸ“·ï¼Œèµ„æºç”¨ ğŸ“¦
- [ ] èµ„æºæ¡ç›®æ˜¾ç¤ºå›¾ç‰‡æ•°é‡å’Œæç¤ºè¯é¢„è§ˆ

### Phase 3: PromptInput

- [ ] å®ç° `insertResourceTag` å‡½æ•°
- [ ] èµ„æºæ ‡ç­¾ä½¿ç”¨è“è‰²ç³»æ ·å¼
- [ ] æ‰©å±• `parseContent` è¯†åˆ« `data-resource-id`
- [ ] æ›´æ–° `useEffect` ä¸­çš„ DOM é‡å»ºé€»è¾‘

### Phase 4: GenerationStore

- [ ] æ‰©å±• `getSerializedPrompt`ï¼šåµŒå…¥èµ„æºæç¤ºè¯
- [ ] æ‰©å±• `getReferencedImagePaths`ï¼šåŒ…å«èµ„æºå›¾ç‰‡
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•éªŒè¯é€»è¾‘

### Phase 5: ä¼˜åŒ–

- [ ] èµ„æºåº“å¡ç‰‡ UI ä¼˜åŒ–
- [ ] Placeholder æ–‡æ¡ˆæ›´æ–°ï¼š"Type @ to add image or resource"
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•ï¼šåˆ›å»ºèµ„æº â†’ @ å¼•ç”¨ â†’ ç”Ÿæˆ

---

## ğŸš¨ æ³¨æ„äº‹é¡¹ä¸è¾¹ç•Œæƒ…å†µ

### 1. èµ„æºè¢«åˆ é™¤åçš„å¤„ç†

å¦‚æœç”¨æˆ·åœ¨ prompt ä¸­å¼•ç”¨äº†ä¸€ä¸ªèµ„æºï¼Œä½†è¯¥èµ„æºéšåè¢«åˆ é™¤ï¼š

- **å½“å‰çº¦å®š**ï¼šæ˜¾ç¤º `[ğŸ“¦ Unknown Resource]`
- **åå°è¡Œä¸º**ï¼šè·³è¿‡è¯¥èµ„æºï¼Œä¸æ³¨å…¥ä»»ä½•å†…å®¹
- **å¯é€‰ä¼˜åŒ–**ï¼šä¿å­˜æ—¶è­¦å‘Šç”¨æˆ·"ä»¥ä¸‹èµ„æºä¸å­˜åœ¨"

### 2. å¾ªç¯å¼•ç”¨é˜²æŠ¤

å¦‚æœæœªæ¥æ”¯æŒèµ„æºåµŒå¥—ï¼ˆèµ„æº A çš„æç¤ºè¯ä¸­å¼•ç”¨èµ„æº Bï¼‰ï¼Œéœ€é˜²æ­¢å¾ªç¯å¼•ç”¨ã€‚

**å½“å‰é˜¶æ®µä¸æ”¯æŒèµ„æºåµŒå¥—**ï¼Œèµ„æºçš„ `promptTemplate` ä»…æ”¯æŒçº¯æ–‡æœ¬ã€‚

### 3. å›¾ç‰‡è·¯å¾„æœ‰æ•ˆæ€§

èµ„æºä¸­çš„å›¾ç‰‡è·¯å¾„å¯èƒ½å¤±æ•ˆï¼ˆæ–‡ä»¶è¢«ç§»åŠ¨/åˆ é™¤ï¼‰ï¼š

- **å±•ç¤ºæ—¶**ï¼šæ£€æµ‹è·¯å¾„æ˜¯å¦æœ‰æ•ˆï¼Œæ— æ•ˆæ˜¾ç¤ºå ä½å›¾
- **ç”Ÿæˆæ—¶**ï¼šè·³è¿‡æ— æ•ˆè·¯å¾„ï¼Œor æŠ›å‡ºé”™è¯¯æç¤ºç”¨æˆ·

### 4. å¤§é‡å›¾ç‰‡çš„æ€§èƒ½

å¦‚æœèµ„æºåŒ…å«å¤§é‡å›¾ç‰‡ï¼ˆå¦‚ 10+ å¼ ï¼‰ï¼Œéœ€è€ƒè™‘ï¼š

- Base64 ç¼–ç åçš„è¯·æ±‚ä½“å¤§å°é™åˆ¶ï¼ˆè±†åŒ… API é™åˆ¶ 64 MBï¼‰
- ç¼©ç•¥å›¾ç”Ÿæˆçš„å†…å­˜å ç”¨
- **å»ºè®®é™åˆ¶**ï¼šå•ä¸ªèµ„æºæœ€å¤šåŒ…å« 5 å¼ å›¾ç‰‡

---

## ğŸ“ å¯é€‰æ‰©å±•

### æ‰©å±• A: èµ„æºæ¨¡æ¿å˜é‡

å…è®¸èµ„æºæç¤ºè¯ä¸­åŒ…å«å˜é‡å ä½ç¬¦ï¼š

```
anime style, {character_name}, vibrant colors
```

å¼•ç”¨æ—¶å¼¹å‡ºå¯¹è¯æ¡†è®©ç”¨æˆ·å¡«å†™å˜é‡å€¼ã€‚

### æ‰©å±• B: èµ„æºåˆ†ç»„/æ ‡ç­¾

ä¸ºèµ„æºæ·»åŠ æ ‡ç­¾ç³»ç»Ÿï¼Œä¾¿äºåˆ†ç±»ç®¡ç†ï¼š

- é£æ ¼ç±»ï¼ˆAnimeã€Realisticã€Fantasyï¼‰
- ç”¨é€”ç±»ï¼ˆè§’è‰²ã€èƒŒæ™¯ã€ç‰©å“ï¼‰
- è‡ªå®šä¹‰æ ‡ç­¾

### æ‰©å±• C: èµ„æºå…±äº«

å¯¼å‡ºèµ„æºä¸º JSON æ–‡ä»¶ï¼Œæ”¯æŒå¯¼å…¥/åˆ†äº«ã€‚

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `src/types/prompt.ts` - PromptContent ç±»å‹å®šä¹‰
- `src/stores/resourceStore.ts` - èµ„æºçŠ¶æ€ç®¡ç†
- `src/stores/referenceImageStore.ts` - å‚è€ƒå›¾ç‰‡çŠ¶æ€ç®¡ç†
- `src/stores/generationStore.ts` - å›¾åƒç”ŸæˆçŠ¶æ€ç®¡ç†
- `src/features/resource-library/` - èµ„æºåº“é¡µé¢ç»„ä»¶
- `src/features/creative-studio/components/MentionMenu.tsx` - @ æåŠèœå•
- `src/features/creative-studio/components/PromptInput.tsx` - æç¤ºè¯è¾“å…¥æ¡†
- `docs/reference-image-feature-plan.md` - å‚è€ƒå›¾åŠŸèƒ½è®¡åˆ’ï¼ˆå‚è€ƒï¼‰

---

## ğŸ“† æ—¶é—´ä¼°ç®—

| é˜¶æ®µ                          | é¢„è®¡æ—¶é—´      |
| ----------------------------- | ------------- |
| Phase 1: ç±»å‹ä¸æ•°æ®å±‚         | 30 åˆ†é’Ÿ       |
| Phase 2: MentionMenu æ‰©å±•     | 1 å°æ—¶        |
| Phase 3: PromptInput æ‰©å±•     | 1 å°æ—¶        |
| Phase 4: GenerationStore é€»è¾‘ | 1 å°æ—¶        |
| Phase 5: UI/UX ä¼˜åŒ–           | 30 åˆ†é’Ÿ       |
| æµ‹è¯•ä¸è°ƒè¯•                    | 1 å°æ—¶        |
| **æ€»è®¡**                      | **çº¦ 5 å°æ—¶** |
